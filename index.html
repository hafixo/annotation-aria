<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ARIA Annotations</title>
    <script src="https://www.w3.org/Tools/respec/respec-w3c-common" class="remove"></script>
    <script class='remove'>
      // See https://github.com/w3c/respec/wiki/ for how to configure ReSpec
      var respecConfig = {
        specStatus: "ED",
        shortName: "annotation-aria",
        format: "markdown",
        copyrightStart:  "2019",

        editors: [
		{
			name: "Michael Cooper",
			company: "W3C",
			companyURL: "http://www.w3.org",
			w3cid: 34017
		},
        {
          name: "Aaron Leventhal",
          company: "Google, Inc.",
          companyURL: "https://google.com/",
          w3cid: 98631
        },
        {
          name: "Benjamin Young",
          url: "http://bigbluehat.com/",
          company: "John Wiley &amp; Sons, Inc.",
          companyURL: "http://www.wiley.com/",
          mailto: "byoung@bigbluehat.com",
          w3cid: 65468
        }],
        github: "https://github.com/w3c/annotation-aria",
        edDraftURI: "https://w3c.github.io/annotation-aria/",
        doJsonLd: true,
        wg: "Accessible Rich Internet Applications Working Group",
        wgURI: "https://www.w3.org/WAI/ARIA/",
        wgPublicList: "public-aria",
        wgPatentURI: "https://www.w3.org/2004/01/pp-impl/83726/status"
      };
    </script>
  </head>
  <body>
    <section id="abstract">
      <p>
        ARIA Annotations provides markup for accessible, in-page annotations.
        This specification describes the mechanism for signaling that
        content has been annotated, for what purpose, and where to find the
        related additional content.
      </p>
    </section>
    <section id="sotd">
      <p>
        This is an unofficial proposal.
      </p>
    </section>

    <section id="introduction">

# Introduction

Annotations provide additional content about the primary content of a document.
Their uses vary from commentary, to suggested edits, to attribution, and even
noting the presence of other readers.

Much of the necessary building blocks already exist with other ARIA specifications.
This specification provides the minimal additions needed to improve
the reading experience of annotated content when consumed via assistive technology.

Additionally, this specification takes steps to use consistent terminology and
modeling from past annotation specifications at the W3C, most notably the Web
Annotation Data Model [[annotation-model]].

## Definitions

The following terminology is informed by the Web Annotation Data Model [[annotation-model]]
specification. You can read more about [the underlying conceptual model in that
introduction](https://www.w3.org/TR/annotation-model/#introduction).

<div class="issue">@bigbluehat: perhaps a similar graph (as the one in the
  WADM) showing the relationship between the parts would be helpful here.</div>

<dl>
  <dt><dfn>annotation</dfn></dt>
  <dd>An annotation is the combination of <a>annotated content</a> and its related <a>annotation body</a>.</dd>

  <dt><dfn>annotated content</dfn></dt>
  <dd>The annotated content is the range of text or other object which the <a>annotation body</a> is "about".
  <!-- TODO: make this more respec-y -->
  <blockquote>Note: In the <a href="https://www.w3.org/TR/annotation-model/#motivation-and-purpose">Web Annotations Data Model</a>,
    this is known as the <strong>annotation target</strong>. However, because
    the term "target" has a specific meaning in accessibility APIs as the end
    (and not beginning) of a relation, the term annotated content is preferred
    here, in order to avoid confusion with the actual directionality of
    <code>aria-details</code> in ARIA annotation markup.</blockquote></dd>

  <dt><dfn>annotation body</dfn></dt>
  <dd>The annotation body is visible information within a page which is connected to <a>annotated content</a> for a related purpose.</dd>

  <dt><dfn>annotation purpose</dfn></dt>
  <dd>The annotation purpose is the role the <a>annotation body</a> plays in relation to the <a>annotated content</a> (e.g. commentary vs. a footnote).</dd>

</dl>

## How do ARIA annotations relate to the Web Annotations Data Model?

ARIA annotations are deliberatly more limited than what can be expressed within
a Web Annotations Data Model [[annotation-model]] document. For example:
* ARIA annotations cannot point to information external to the current Web page
* ARIA annotations must point to *something* within the current Web page to provide the additional content

In addition, ARIA annotations do not contain as much information as they only
contain what is necessary to move between the primary annotated content, and
the additional content.

Authors desiring to expand the expresiveness of their markup beyond what is
provided by ARIA annotations should consult the Embedding Web Annotations in
HTML Note [[annotation-html]].

For further information, please see the [](#annotation-model-mappings) below.
    </section>

<section id="use-cases">
# Use Cases

## Web Content

*   Document editor
*   Code editor
*   Published content

## Assistive Technology

* AT user issues command to navigate to previous/next <a>annotated content</a> (e.g. next commented text)
* AT user issues command to navigate to previous/next <a>annotation body</a> (e.g. next comment)
* AT user issues one of the above commands, but filtered by <a>annotation purpose</a> (e.g. commentary only)
* AT user issues command to navigate from <a>annotation body</a> to the <a>annotated content</a>, or vice-versa
* Screen reader provides viewing options for reading <a>annotation purposes</a>, where the purpose is shortened, e.g. "commentary" becomes "*ct"
</section>

<section id="markup">
  <h1>Annotation Markup</h1>

  <p>ARIA annotations are built from existing ARIA attributes. This specification
  does introduce new <code>role</code> values to distinguish the purpose of
  <a>annotated content</a> from among each other and from among other content
  within the current page.</p>

  <h2><code>aria-details</code></h2>

  <p><a>Annotated content</a> markup MUST use the <code>aria-details</code>
  attribute which MUST contain the IDREF of an <a>annotation body</a> which
  exists in the current web page.</p>

  <p>Any HTML tag MAY be used. It is not required to use the <code>role</code>
  attribute. However, when a visible highlight is intended, authors SHOULD prefer
  using an element such as <code>&lt;mark&gt;</code> over a more semantically
  generic and visually invisible element such as <code>&lt;span&gt;</code>.</p>

  <p>The <code>aria-details</code> attribute MUST reference an element within
  the current Web page which contains the <a>annotation body</a>.</p>

  <pre class="example highlight">
  &lt;p&gt;&lt;mark aria-details="comment-123"&gt;The proposal&lt;/mark&gt; contains...&lt;/p&gt;
  ...
  &lt;div id="comment-123"&gt;I think this is great!&lt;/div&gt;
  </pre>

  <p>Use of the
  <a href="https://w3c.github.io/aria/#aria-details"><code>aria-details</code></a>
  attribute MUST follow any additiona requirements expressed in the
  Accessible Rich Internet Applications [[wai-aria-1.2]] specification.</p>

## `role`

The <a>annotation body</a> contains the commentary, suggestions, or secondary
content about the <a>annotated content</a>.

The `role` on the <a>annotation body</a> describes the purpose or intent (i.e.
the <a>annotation purpose</a>) of the <a>annotation body</a>. See below for a
[list of available roles](#roles) meant for use in ARIA annotations.

<pre class="example highlight">
  &lt;p&gt;&lt;mark aria-details="comment-123"&gt;The proposal&lt;/mark&gt; contains...&lt;/p&gt;
  ...
  &lt;div id="comment-123" role="annotation-commentary"&gt;I think this is great!&lt;/div&gt;
</pre>

Multiple `role` attribute values are supported. If more than one `role` value
is provided then the first recognized `role` MAY be mapped through
accessibility APIs. Consequently, annotation authors SHOULD place the most
important (or specific) role first.

For example, the following would indicate that there is a suggestion with
comments, but some APIs may only expose it as a "suggestion":

<pre class="example highlight">
  &lt;p&gt;&lt;mark aria-details="suggestion-123"&gt;The proposal&lt;/mark&gt; contains...&lt;/p&gt;
  ...
  &lt;div id="suggestion-123" role="annotation-suggestion annotation-commentary group"&gt;
    I think this is great! However, I think you might want to change "proposal"
    to "recommendation."
  &lt;/div&gt;
</pre>

## `&lt;ins&gt;`/`&lt;del&gt;`

Annotations motivated by expressing a revision to the <a>annotated content</a>
or which are providing suggestions to that content come with an additional
requirement to convey that revision or suggestion.

The <a>annotated content</a> of such a change-related annotation MUST contain
at least one HTML `&lt;ins&gt;` or `&lt;del&gt;` tag. If a replacement to the
<a>annotated content</a> is being requested, authors MUST provide both an
`&lt;ins&gt;` and a `&lt;del&gt;` tag together. Each combination of an
`&lt;ins&gt;` and a `&lt;del&gt;` tag pair SHOULD be authored as separate
<a>annotated content</a>.

<pre class="example highlight">
&lt;p&gt;Everyone is encouraged to bring a
&lt;span aria-details="suggestion-info-1"&gt;&lt;del&gt;side dish&lt;/del&gt;&lt;ins&gt;beverage&lt;/ins&gt;&lt;/span&gt;
to share.&lt;/p&gt;
</pre>

Assistive Technology SHOULD handle all permutations of the ordering of
`&lt;ins&gt;` and `&lt;del&gt;` when processing edits.

<div class="note">In future, the [[wai-aria-1.2]] specification may define
  whether the order of `&lt;ins&gt;` and `&lt;del&gt;` are important.</div>

<div class="issue" data-number="3"></div>

To distinguish between revisions (past edits) and suggestions (future edits),
an <a>annotation purpose</a> can be expressed by placing the appropriate `role`
value on the related <a>annotation body</a>.

<pre class="example highlight">
&lt;p&gt;Everyone is encouraged to bring a
&lt;span aria-details="suggestion-info-1"&gt;&lt;del&gt;side dish&lt;/del&gt;&lt;ins&gt;beverage&lt;/ins&gt;&lt;/span&gt;
to share.&lt;/p&gt;
&lt;!-- later in the document... --&gt;
&lt;div id="suggestion-info-1" role="annotation-suggestion"&gt;
Change of plans! Thanks updating this, Aaron
&lt;/div&gt;
</pre>



## `aria-label`/`aria-labelledby`/`aria-describedby`

(optional)

<div class="issue">@bigbluehat update this to be non-normitave/description/examplary</div>

In addition, this markup may be helpful, but is not really part of the annotations spec:

*   If this is found on the <a>annotation body</a>, it could provides a useful label or description for the <a>annotation</a>, that could be presented by a screen reader in a mode where the user wanted to understand more about the <a>annotation bodies</a> in context but the <a>annotation bodies</a> themselves would be too long.
</section>

<section id="roles">
# Roles for <a>annotation purposes</a>

These go on the <a>annotation body</a>, not the <a>annotated content</a>.

All <code>annotation-</code> prefixed `role` values would inherit from an abstract role of `annotation`, which would inherit from `structure`. If the `role` attribute is not provided, then the <a>annotation</a> is simply treated as a description, as it would already be via `aria-details` usage.

*   **annotation-attribution** — authoring information for the <a>annotated content</a>.
<div class="issue" data-number="4"></div>
<div class="issue" data-number="5"></div>

*   **annotation-commentary** — one or more comments, or a comment thread
*   **annotation-description**  — generic description. This is also the default if the annotation purpose is unspecified.
<div class="issue" data-number="6"></div>

*   **annotation-revision** — this is a historical change that has already been accepted. The source <a>annotated content</a> will contain 1-2 children for the insertion and/or deletion.
*   **annotation-suggestion** — proposed edit. The source <a>annotated content</a> will contain 1-2 children for the proposed insertion and/or deletion.

*   **annotation-presence** — similar to attribution, but relates to editing that is happening right now. For example, "Mr. Smith is editing nearby".
*   **doc-footnote**/**doc-endnote** for footnotes and endnotes. When using DPUB roles, the <a>annotated content</a> will be the referencing note number. The author may choose to leave out the `doc-noteref` role on the <a>annotated content</a>, as that will be exposed as a link to ATs (see [[DPUB-AAM-1.0]]), and it may not be a link. In addition, the fact that it is a note reference number is implied by the relation with the <a>annotation body</a>, which will have the `doc-footnote` or `doc-endnote` role.

Use the singular form: for consistency, all of the <a>annotation purposes</a> are in the singular form of the word, even though in some cases the plural could have made sense, as in "suggestion" where there may be multiple suggestions.
</section>

<section id="annotation-model-mappings">
## Web Annotation Data Model correlations

An important use case is to convert annotation data from the Web Annotation Data Model [[annotation-model]] (typically in JSON format) into accessible content, with the goal of enabling AT support. The following are non-normative suggestions for accomplishing this.

<aside class="example" title="Describing a relationship to in-page visible content">

Translating a "commenting" motivation in the Web Annotation Data Model to the appropriate ARIA and HTML markup:

<pre class="highlight">
  &lt;p&gt;The following cats have been deemed &lt;span aria-details="comment-thread-1"&gt;uncooperative&lt;/span&gt;.&lt;/p&gt;
  &lt;div id="comment-thread-1" role="annotation-commentary"&gt;
  &lt;h1&gt;Comment by Ruff Finkledog&lt;/h1&gt;
  &lt;p&gt;Wouldn't it be simpler to list the cooperative cats?&lt;/p&gt;
  &lt;/div&gt;
</pre>
</aside>

<aside class="example" title="Describing a Web Annotation that does not have a relationship to other content">

This example is useful for the "highlighting" motivation.

<pre class="highlight">
&lt;p&gt;The word &lt;mark&gt;cat&lt;/mark&gt; is highlighted&lt;/p&gt;
</pre>
</aside>

<aside class="example" title="Describing a Web Annotation that is related to external content only">

This example is useful for the "identifying" motivation.

<pre class="highlight">
&lt;p&gt;A &lt;a href="https://en.wikipedia.org/wiki/Cat"&gt;cat&lt;/a&gt; is one of our favorite quirky pets.&lt;/p&gt;
</pre>
</aside>

### Purpose to Role Mapping Table

<table>
  <thead>
    <tr>
      <th>Web Annotation motivation/purpose</th>
      <th>Proposed &nbsp;additional markup on annotation</th>
      <th>Proposed markup on annotated content</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Assessing</td>
      <td><code>role="annotation-commentary"</code></td>
      <td><code>aria-details=[id]</code></td>
      <td>The motivation for when the user intends to assess the target resource in some way, rather than simply make a comment about it. For example to write a review or assessment of a book, assess the quality of a dataset, or provide an assessment of a student's work.</td>
    </tr>
    <tr>
      <td>Bookmarking</td>
      <td>none</td>
      <td>
        <p><code>aria-details=[id]</code></p>
      </td>
      <td>The motivation for when the user intends to create a bookmark to the Target or part thereof. For example an Annotation that bookmarks the point in a text where the reader finished reading.</td>
    </tr>
    <tr>
      <td>
        <p>Classifying</p>
      </td>
      <td><code>role="annotation-description"</code></td>
      <td><code>aria-details=[id]</code> (if classifications visible in page)</td>
      <td>The motivation for when the user intends to classify the Target as something. For example to classify an image as a portrait.</td>
    </tr>
    <tr>
      <td>Commenting</td>
      <td><code>role="annotation-commentary"</code></td>
      <td><code>aria-details=[id]</code></td>
      <td>The motivation for when the user intends to comment about the Target. For example to provide a commentary about a particular PDF document.</td>
    </tr>
    <tr>
      <td>Describing</td>
      <td><code>role="annotation-description"</code></td>
      <td><code>aria-details=[id]</code></td>
      <td>The motivation for when the user intends to describe the Target, as opposed to (for example) a comment about it. For example describing the above PDF's contents, rather than commenting on their accuracy.</td>
    </tr>
    <tr>
      <td>Editing</td>
      <td><code>role="annotation-suggestion"</code></td>
      <td>
        <p><code>aria-details=[id]</code></p>
        <p>Must also have <code>&lt;ins&gt;</code>, <code>&lt;del&gt;</code> child or both </p>
      </td>
      <td>The motivation for when the user intends to request a change or edit to the Target resource. For example an Annotation that requests a typo to be corrected.</td>
    </tr>
    <tr>
      <td>Highlighting</td>
      <td>none</td>
      <td>Use <code>&lt;mark&gt;</code> or appropriate ARIA <code>role</code> from role parity work once available</td>
      <td>The motivation for when the user intends to highlight the Target resource or segment of it. For example to draw attention to the selected text that the annotator disagrees with.</td>
    </tr>
    <tr>
      <td>Identifying</td>
      <td>none</td>
      <td><code>&lt;a href=[IRI]&gt;external link&lt;/a&gt;</code></td>
      <td>The motivation for when the user intends to assign an identity to the Target. For example to associate the IRI that identifies a city with a mention of the city in a web page.</td>
    </tr>
    <tr>
      <td>Linking</td>
      <td>none</td>
      <td><code>aria-details=[id]</code></td>
      <td>The motivation for when the user intends to link to a resource related to the Target.</td>
    </tr>
    <tr>
      <td>Moderating</td>
      <td><code>role="annotation-commentary"</code></td>
      <td><code>aria-details=[id]</code></td>
      <td>The motivation for when the user intends to assign some value or quality to the Target. For example annotating an Annotation to moderate it up in a trust network or threaded discussion.</td>
    </tr>
    <tr>
      <td>Questioning</td>
      <td><code>role="annotation-commentary"</code></td>
      <td><code>aria-details=[id]</code></td>
      <td>The motivation for when the user intends to ask a question about the Target. For example, to ask for assistance with a particular section of text, or question its veracity.</td>
    </tr>
    <tr>
      <td>Replying</td>
      <td><code>role="annotation-commentary"</code></td>
      <td><code>aria-details=[id]</code></td>
      <td>The motivation for when the user intends to reply to a previous statement, either an Annotation or another resource. For example providing the assistance requested in the above.</td>
    </tr>
    <tr>
      <td>Tagging</td>
      <td><code>role="note"</code>, e.g. <code>&lt;div role="note"&gt;Tags: cats, pets&lt;/div&gt;</code></td>
      <td><code>aria-details=[id]</code> (if tags are visible in content)</td>
      <td>The motivation for when the user intends to associate a tag with the Target.</td>
    </tr>
    <tr>
      <td>Attribution from provenance chunk</td>
      <td><code>role="annotation-attribution"</code></td>
      <td><code>aria-details=[id]</code> (if attribution is visible in content)</td>
      <td>Authoring information for the annotated content</td>
    </tr>
    <tr>
      <td>Does not currently exist in Web Annotations Data Model</td>
      <td><code>role="annotation-revision"</code></td>
      <td>
        <p><code>aria-details=[id]</code></p>
        <p>Must also have <code>&lt;ins&gt;</code>, <code>&lt;del&gt;</code> child or both </p>
      </td>
      <td>This is a historical change that has already been accepted. The source <a>annotated content</a> will contain 1-2 children for the insertion and/or deletion</td>
    </tr>
    <tr>
      <td>Does not currently exist in Web Annotations Data Model</td>
      <td><code>role="annotation-presence"</code></td>
      <td><code>aria-details=[id]</code></td>
      <td></td>
    </tr>
    <tr>
      <td>Does not currently exist in Web Annotations Data Model</td>
      <td><code>role="doc-footnote"</code> | <code>role="doc-endnote"</code> | <code>role="doc-biblioentry"</code></td>
      <td><code>aria-details</code></td>
      <td>In-page links for footnotes, endnotes, bibliographical information in a document</td>
    </tr>
  </tbody>
</table>
</section>

<section id="a11y-mappings">

# Platform Accessibility mappings

*   [UI Automation has built-in support for annotations](https://docs.microsoft.com/en-us/windows/desktop/winauto/uiauto-annotation-type-identifiers) — note that a perfect 1 to 1 mapping is not expected here. For example, a grammar error is an annotation in UIA, but in ARIA is `aria-invalid="grammar"`. An important difference with UIA annotations is that ARIA annotations always link to visible in-page content.
*   Most of the markup is reused — there are already known ways for exposing `aria-details`, `aria-label`, `aria-labelledby`, `aria-describedby`, `&lt;ins&gt;` and `&lt;del>`.
*   For aria-annotation, this should be exposed as an object attribute called "annotation" in ATK/IA2
<div class="issue">@bigbluehat: does "aria-annotation" here mean this spec? It seems to (vs. an attribute or value)</div>

</section>

<section id="rejects" class="appendix">
# Rejected annotation purposes

<div class="issue">@bigbluehat: move this to an appendix? remove it? Kind of nice to know what we didn't do and why</div>

For now, the following annotation purposes have not been assigned new roles:

* **highlight**  — this does not fit the proposed definition of an <a>annotation</a> in that it does not point to additional info. Therefore, ARIA WG should consider adding something like `role=mark` (would need to be added for role parity), or the author can use HTML via `&lt;mark&gt;`/`&lt;em&gt;`/`&lt;strong&gt;`
* **error** — in code in code editor: use the already supported `aria-invalid="true"` + `aria-errormessage=id`
* **warning** — in code editor: may want to add `aria-invalid="warning"` as possible value (and like error, can use `aria-errormessage=id`)
* **bookmark** — similar to `annotation-presence`; would need more info on this use case in order to support it.
<div class="issue">[TBD] @aleventhal: Suggest that the author can use `&lt;mark aria-label="Bookmark name"&gt;` for a good experience.</div>
* **breakpoint**— does not always come with additional visible information, so it would be difficult to shoehorn into this use case.
<div class="issue">[TBD] @aleventhal: For this one, perhaps a `&lt;mark&gt;` or `role="mark"` or a new `role="breakpoint"` could be used, along with `aria-label`. Or, a visible button could be used on the line with the breakpoint, that is labelled as a breakpoint button.</div>
</section>



  </body>
</html>
